#Ch_selenium/example/tutorial3.py
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from bs4 import BeautifulSoup, BeautifulStoneSoup
from selenium.webdriver.support.ui import Select
import time

options = webdriver.ChromeOptions()
options.add_argument("--incognito")
options.add_argument("--window-size=1920x1080")
options.add_argument('--disable-extensions')
options.add_argument('--headless')
options.add_argument('--disable-gpu')
options.add_argument('--no-sandbox')
driver = webdriver.Chrome(
    executable_path = '/home/pjy/hackerton/chromedriver',
    chrome_options=options    
    ) #또는 chromedriver.exe
driver.implicitly_wait(15) # 묵시적 대기, 활성화를 최대 15초가지 기다린다.

url = "https://www.safekorea.go.kr/idsiSFK/neo/sfk/cs/sfc/dis/disasterMsgList.jsp?menuSeq=679"
driver.get(url)
time.sleep(3)

table = driver.find_element_by_class_name('boardList_table')
tbody = table.find_element_by_tag_name("tbody")
rows = tbody.find_elements_by_tag_name("tr")[0]
body= rows.find_elements_by_tag_name("td")
A=[] #가장 최근에 올라온 행 적는것.
for index, value in enumerate(body):
    h=value.text
    A.append(h)
print(A[0]) #확인용 - 삭제
print(type(A[0])) #확인용 - 삭제
A[0]=int(A[0])  # 가장 최근에 올라온 게시글의 번호
print(type(A[0])) #확인용 - 삭제
postcontents=[]
f1=open("number.txt",'r')
line=f1.readline()
f1.close()
if int(line)==A[0]:
    print("최근에 올라온 글이 없습니다.") #확인용-삭제
else:
    print(A[0]-int(line),"개의 글이 올라왔습니다.") #확인용 -삭제
    for i in range(A[0]-int(line)):
        postnumber='bbs_tr_'+str(i)+'_bbs_title'
        click1 = driver.find_element_by_id(postnumber) #게시글 조회
        click1.click()
        table2 = driver.find_element_by_id('cn')
        postcontents.append(table2.text)
        print(postcontents[i]) #확인용 - 삭제
        if '확진' in table2.text:
            print("OK") #트리거 삽입 확인용 - 삭제
        else:
            print("확진없음") #확인용-삭제
        click2=driver.find_element_by_class_name('list_btn')
        click2.click()

f2=open("number.txt",'w')
f2.write(str(A[0]))
f2.write("\n")
f2.close 
# 가장 최근에 올라온 게시글의 번호 저장 및 게시글 저장

time.sleep(5)
driver.quit() # 웹 브라우저 종료. driver.close()는 탭 종료
